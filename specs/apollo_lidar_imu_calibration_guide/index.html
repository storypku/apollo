<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Apollo lidar imu calibration guide - Apollo Docs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Apollo lidar imu calibration guide";
    var mkdocs_page_input_path = "specs/apollo_lidar_imu_calibration_guide.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Apollo Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Get Started</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../quickstart/">Quick Start</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Cyber RT</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../cyber/">Introduction to Cyber RT</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../cyber/CyberRT_Quick_Start/">Cyber RT Quick Start</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Modules</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="../../modules/perception/README.md">Perception</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../modules/control/README.md">Control</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../modules/canbus/README.md">Canbus</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../modules/monitor/README.md">Monitor</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../modules/prediction/README.md">Prediction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/planning/">Planning</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">How-Tos</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../howto/how_to_solve_slow_pull_from_cn/">[CN] How to Solve GitHub Slow Pull</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../howto/how_to_document_code/">How to document code</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../howto/how_to_install_apollo_kernel/">How to install Apollo kernel</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../howto/how_to_install_apollo_kernel_cn/">[CN] How to install Apollo kernel</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../howto/how_to_launch_Apollo/">How to launch and run Apollo</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">FAQs</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/">Index</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/General_FAQs/">General</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/General_FAQs_cn/">[CN] General</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Calibration_FAQs/">Calibration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Calibration_FAQs_cn/">[CN] Calibration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Perception_FAQs/">Perception</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Dreamview_FAQs/">Dreamview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Hardware_FAQs/">Hardware</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Hardware_FAQs_cn/">[CN] Hardware</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Software_FAQs/">Software</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Software_FAQs_cn/">[CN] Software</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/CyberRT_FAQs/">Cyber RT</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">D-Kit</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../D-kit/readme/">[CN] Introduction</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Apollo Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Apollo lidar imu calibration guide</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ApolloAuto/apollo/edit/master/docs/specs/apollo_lidar_imu_calibration_guide.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h3 id="apollo-lidar-imu-calibration-service">Apollo LiDAR - IMU Calibration Service<a class="headerlink" href="#apollo-lidar-imu-calibration-service" title="Permanent link">#</a></h3>
<pre><code>Note:
This guide cannot be used for version Apollo 3.5
</code></pre>

<p>Welcome to the Apollo sensor calibration service. This document describes the process of the extrinsic calibration service between 64-beam Light Detection And Ranging (LiDAR) and Inertial Navigation System (INS).</p>
<h3 id="apollo-sensor-calibration-catalog">Apollo Sensor Calibration Catalog<a class="headerlink" href="#apollo-sensor-calibration-catalog" title="Permanent link">#</a></h3>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#preparing-the-sensors">Preparing the Sensors</a></li>
<li><a href="#recording-calibration-data">Recording calibration data</a></li>
<li><a href="#uploading-calibration-data-and-creating-a-calibration-service-task">Uploading Calibration Data and Creating a Calibration Service Task</a></li>
<li><a href="#obtaining-calibration-results">Obtaining calibration results</a></li>
<li><a href="#types-of-errors">Types of Errors encountered</a></li>
</ul>
<h4 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">#</a></h4>
<p>The Apollo vehicle sensor calibration function provides the extrinsic calibration between Velodyne HDL-64ES3 and IMU. The calibration results can be used to transfer the obstacle location detected by LiDAR to the IMU coordinate system, and then to the world coordinate system. The results are provided in <code>.yaml</code> format files.</p>
<h4 id="preparing-the-sensors">Preparing the Sensors<a class="headerlink" href="#preparing-the-sensors" title="Permanent link">#</a></h4>
<p>In order to calibrate the sensors, it is important to prepare them first, using the following steps:</p>
<ol>
<li>
<p>Install 64-beams LiDAR and INS supported by Apollo, and then deploy the Docker environment.</p>
</li>
<li>
<p>Start up the 64-beams LiDAR and INS. The INS must be aligned when it is powered on. At this point, the car should be driven straight, then turned left and turned right in an open area, until the initialization is completed.</p>
</li>
<li>
<p>Confirm that all sensor topics required by this service have the following output : <a href="https://github.com/ApolloAuto/apollo/blob/master/docs/FAQs/Calibration_FAQs.md">How to Check the Sensor Output?</a></p>
</li>
</ol>
<p>The topics required by the calibration service are shown in the following Table 1:</p>
<p>Table 1. Sensor topics.</p>
<table>
<thead>
<tr>
<th>Sensor</th>
<th>Topic Name</th>
<th>Topic Feq. (Hz)</th>
</tr>
</thead>
<tbody>
<tr>
<td>HDL-64ES3</td>
<td>/apollo/sensor/velodyne64/VelodyneScanUnified</td>
<td>10</td>
</tr>
<tr>
<td>INS</td>
<td>/apollo/sensor/gnss/odometry</td>
<td>100</td>
</tr>
<tr>
<td>INS</td>
<td>/apollo/sensor/gnss/ins_stat</td>
<td>2</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>Confirm that the INS status is 56 when recording data. To learn how please go to : <a href="https://github.com/ApolloAuto/apollo/blob/master/docs/FAQs/Calibration_FAQs.md">How to Check INS Status?</a></p>
</li>
<li>
<p>Choose an appropriate calibration field.</p>
</li>
</ol>
<p>```An ideal calibration field requires no tall buildings around the calibration area. If buildings are near, low-rising building facades are preferred. Finally, the ground should be smooth, not rough, and it should be easy to drive the car following the trajectory that looks like the  ∞ symbol as illustrated in Figure 1. An example of a good calibration field is shown in Figure 2.</p>
<pre><code>
![](images/lidar_calibration/trajectory.png)

&lt;p align=&quot;center&quot;&gt;Figure 1. The trajectory  for calibration.&lt;/p&gt;

![](images/lidar_calibration/field.png)

&lt;p align=&quot;center&quot;&gt;Figure 2. Calibration field.&lt;/p&gt;

### Recording Calibration Data

After the preparation steps are completed, drive the vehicle to the calibration field to record the calibration data.

1. The recording script is `apollo/script/lidar_calibration.sh`.

2. Run the following command to record data:

```bash
  bash lidar_calibration.sh start_record
</code></pre>

<p>The recorded bag is under the directory <code>apollo/data/bag</code>.</p>
<ol>
<li>
<p>Drive the car following a ∞ symbol path, using a controlled speed of 20-40km/h, and make the turning radius as small as possible. The total time length should within 3 minutes, but please make sure that your calibration drive contains at least one full ∞ symbol path.</p>
</li>
<li>
<p>After recording, run the following command to stop the data recording:</p>
</li>
</ol>
<pre><code class="bash">  bash lidar_calibration.sh stop_record
</code></pre>

<ol>
<li>Then, the program will detect whether or not the recorded bag contains all the required topics. After passing the test, the bag will be packaged into file <code>lidar_calib_data.tar.gz</code>, including the recorded rosbag and the corresponding MD5 checksum file.</li>
</ol>
<h4 id="uploading-calibration-data-and-creating-a-calibration-service-task">Uploading Calibration Data and Creating a Calibration Service Task<a class="headerlink" href="#uploading-calibration-data-and-creating-a-calibration-service-task" title="Permanent link">#</a></h4>
<p>After recording the calibration data, please login to the <a href="https://console.bce.baidu.com/apollo/calibrator/index/list">calibration service page</a> to complete the calibration.</p>
<ol>
<li>
<p>Enter the calibration service page and click the <strong>New Task</strong> button under the <strong>Task Management</strong> list to create a new calibration task.</p>
</li>
<li>
<p>After entering the New Task page, you need to fill in a simple description of this task. Then click the <strong>Upload and create a task</strong> button and select the upload calibration file to start uploading the calibration data.</p>
</li>
<li>
<p>After you start uploading the data, the page will display the Task Process View. The process figure is the upload progress page. The task will start to calibrate when the upload progress reaches 100%. Please keep the network unblocked during uploading.</p>
</li>
<li>
<p>When the data is uploaded, the Data Verification Process will begin, as shown in Figure 3. The validation process ensures data integrity and suitability. The validation list include:</p>
</li>
<li>
<p>Decompress test</p>
</li>
<li>MD5 checksum</li>
<li>Data format validation</li>
<li>∞ symbol path validation</li>
<li>INS status validation</li>
</ol>
<p>If validation fails, the corresponding error message is prompted as seen in the third Result of the Data Validation screen below in Figure 3.</p>
<p><img alt="" src="../images/lidar_calibration/calib_valid_en.png" />
<p align="center">Figure 3. Calibration data verification.</p></p>
<ol>
<li>
<p>After data validation, the calibration process begins, as shown in Figure 4.  A detailed calibration progress page is displayed to users. Depending on the size and quality of the data, the overall calibration time lasts about 10 - 30 minutes. You can check the progress at any time by opening the given page.
<img alt="" src="../images/lidar_calibration/calib_progress_en.png" />
<p align="center">Figure 4. Calibration progress page.</p></p>
</li>
<li>
<p>When calibration succeeds, click the <strong>View detail</strong> button to display a stitched point cloud. You can confirm the quality verification by checking the sharpness of the point cloud. If you are satisfied with the calibration quality, you can click <strong>Confirm</strong> to keep the result and download the calibration results by clicking <strong>Download</strong>. This fulfills the completion of the calibration process.</p>
</li>
</ol>
<p>For additional information, see: <a href="https://github.com/ApolloAuto/apollo/blob/master/docs/FAQs/Calibration_FAQs.md">How to Check Point Cloud Quality?</a></p>
<h4 id="obtaining-calibration-results">Obtaining Calibration Results<a class="headerlink" href="#obtaining-calibration-results" title="Permanent link">#</a></h4>
<ol>
<li>
<p>Before obtaining the calibration results, the service requires that you confirm the quality of the calibration results based on visualized point cloud.</p>
</li>
<li>
<p>After confirming the quality of the calibration result, you can click on the <strong>Confirm</strong> button to store the calibration result. After that, you can download the result on the Task page. The <strong>Download</strong> button will <em>NOT</em> appear on the task page if the result failed to pass quality verification.</p>
</li>
<li>
<p>Extrinsic file format instruction —  The extrinsic is returned to you in a <code>.yaml</code> format file. We can look an at example of the format of the extrinsic file below:</p>
</li>
</ol>
<p>The field meanings shown in this example are defined in Table 2.</p>
<pre><code class="bash">header:
  seq: 0
  stamp:
     secs: 1504765807
     nsecs: 0
  frame_id: novatel
child_frame_id: velodyne64
transform:
  rotation:
    x: 0.02883904659307384
     y: -0.03212457531272153
     z: 0.697030811535172
     w: 0.7157404339725393
  translation:
     x: 0.000908140840832566
     y: 1.596564931858745
     z: 1
</code></pre>

<p>Table 2. Definition of the keys in the yaml file</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>header</code></td>
<td>Header information, including timestamps.</td>
</tr>
<tr>
<td><code>child_frame_id</code></td>
<td>Source sensor ID in calibration. Will be HDL-64ES3 here.</td>
</tr>
<tr>
<td><code>frame_id</code></td>
<td>Target sensor ID in calibration. Will be Novatel here.</td>
</tr>
<tr>
<td><code>rotation</code></td>
<td>Rotation part of the extrinsic parameters. Represented by a quaternion.</td>
</tr>
<tr>
<td><code>translation</code></td>
<td>Translation part of the extrinsic parameters.</td>
</tr>
</tbody>
</table>
<ol>
<li>How to use extrinsic parameters?</li>
</ol>
<p>Enter the following command to create the calibration file directory in the apollo directory:</p>
<pre><code class="bash">mkdir -p modules/calibration/data/[CAR_ID]/
</code></pre>

<p>Here, <strong>CAR_ID</strong> is the vehicle ID for calibrating vehicles. Then, copy the downloaded extrinsic yaml file to the corresponding <strong>CAR_ID</strong> folder. Finally, after you start HMI, select the correct <strong>CAR_ID</strong> to load the corresponding calibration yaml file.</p>
<h4 id="types-of-errors-encountered">Types of Errors encountered<a class="headerlink" href="#types-of-errors-encountered" title="Permanent link">#</a></h4>
<ol>
<li><strong>Data unpacking error</strong>: The uploaded data is not a valid <code>tar.gz</code> file</li>
<li><strong>MD5 checksum error</strong>:  If the MD5 checksum of the uploaded data differs from the MD5 checksum computed by the server side, it could be caused by network transmission problems.</li>
<li><strong>Data format error</strong>:  The uploaded data is not a rosbag, or necessary topics are missing or unexpected topics exist. The server-side calibration program failed to read it.</li>
<li><strong>No ∞ symbol path error</strong>:  No ∞ symbol path was found in the uploaded data. Verify that the recorded data contains at least one ∞ symbol path.</li>
<li><strong>INS status error</strong>:  In the uploaded data, the location does not meet the requirement. Ensure that the INS status is 56 during the data recording.</li>
</ol>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ApolloAuto/apollo/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
