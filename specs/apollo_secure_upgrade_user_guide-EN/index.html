<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Apollo Secure Upgrade SDK - Apollo Docs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Apollo Secure Upgrade SDK";
    var mkdocs_page_input_path = "specs/apollo_secure_upgrade_user_guide-EN.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Apollo Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Get Started</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../quickstart/">Quick Start</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Cyber RT</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../cyber/">Introduction to Cyber RT</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../cyber/CyberRT_Quick_Start/">Cyber RT Quick Start</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Modules</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="../../modules/perception/README.md">Perception</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../modules/control/README.md">Control</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../modules/canbus/README.md">Canbus</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../modules/monitor/README.md">Monitor</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../modules/prediction/README.md">Prediction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/planning/">Planning</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">How-Tos</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../howto/how_to_solve_slow_pull_from_cn/">[CN] How to Solve GitHub Slow Pull</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../howto/how_to_document_code/">How to document code</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../howto/how_to_install_apollo_kernel/">How to install Apollo kernel</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../howto/how_to_install_apollo_kernel_cn/">[CN] How to install Apollo kernel</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../howto/how_to_launch_Apollo/">How to launch and run Apollo</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">FAQs</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/">Index</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/General_FAQs/">General</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/General_FAQs_cn/">[CN] General</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Calibration_FAQs/">Calibration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Calibration_FAQs_cn/">[CN] Calibration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Perception_FAQs/">Perception</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Dreamview_FAQs/">Dreamview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Hardware_FAQs/">Hardware</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Hardware_FAQs_cn/">[CN] Hardware</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Software_FAQs/">Software</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Software_FAQs_cn/">[CN] Software</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">D-Kit</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../D-kit/readme/">[CN] Introduction</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Apollo Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Apollo Secure Upgrade SDK</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ApolloAuto/apollo/edit/master/docs/specs/apollo_secure_upgrade_user_guide-EN.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="apollo-secure-upgrade-sdk">Apollo Secure Upgrade SDK<a class="headerlink" href="#apollo-secure-upgrade-sdk" title="Permanent link">#</a></h2>
<p>Currently, most software upgrade solutions are not securely protected. Therefore, devices are exposed to various security threats during the upgrade procedure. Apollo secure upgrade SDK provides secure upgrade capabilities, and can be easily integrated to make the upgrade process more secure and robust.</p>
<h3 id="features">Features<a class="headerlink" href="#features" title="Permanent link">#</a></h3>
<ol>
<li>Packages are encrypted and signature protected in storing and transmitting phases.</li>
<li>Server and device can authenticate each other.</li>
<li>Cryptographic resources are protected properly.</li>
<li>Server provides customized authorizations to different devices.</li>
<li>Prevent attackers utilizing the serverâ€™s response to replay attack devices.</li>
<li>Multiple platforms (Ubuntu 14, Centos 6, Centos 7 and Andorid) are supported.</li>
</ol>
<h3 id="upgrade-procedure">Upgrade Procedure<a class="headerlink" href="#upgrade-procedure" title="Permanent link">#</a></h3>
<p>A typical upgrade procedure is shown below:</p>
<p><img alt="" src="../images/apollo_unsecure_upgrade_procedure.jpg" /></p>
<ol>
<li>The upgrade server generates the upgrade package.</li>
<li>Packages are uploaded to the storage server.</li>
<li>Storage server sends the package URL to upgrade server.</li>
<li>Device sends the upgrade request to upgrade server.</li>
<li>Upgrade server replies package URL to the device.</li>
<li>Device requests package from the storage server.</li>
<li>Packages are downloaded to device.</li>
<li>Device installs the package.</li>
</ol>
<p>After integrating secure upgrade SDK, the upgrade procedure is modified as follows:</p>
<p><img alt="" src="../images/apollo_secure_upgrade_procedure.jpg" /></p>
<ol>
<li>The upgrade server generates the secure package and package token.</li>
<li>Secure packages and the package token are uploaded to the storage server.</li>
<li>The storage server sends secure package and package token URLs to the upgrade server.</li>
<li>The device generates the device token and sends to the upgrade server with the upgrade request.</li>
<li>The upgrade server generates authorization token and sends the token to the device with a replied secure package URL.</li>
<li>Device requests secure package from the storage server.</li>
<li>Secure packages are downloaded to device.</li>
<li>Device verifies the secure package with the authorization token, and generates the original package. </li>
<li>Device installs the package.</li>
</ol>
<h3 id="user-guide">User Guide<a class="headerlink" href="#user-guide" title="Permanent link">#</a></h3>
<h4>1. SDK Layout</h4>
<p>SDK contains four directories:
1. python API: python interface.
2. config: SDK root configuration file, log file.
3. certificate: certificate file.
4. depend_lib: dependency libraries.</p>
<h4>2. Interfaces</h4>
<h5>a) Initialize</h5>
<p>This function should be called before using secure upgrade APIs.</p>
<pre><code>init_secure_upgrade(root_config_path)
input para:
  root_config_path  root configuration file path
</code></pre>

<h5>b) Device Token Generation</h5>
<p>This function is used to generate the device token.</p>
<pre><code>sec_upgrade_get_device_token()
Output para:
  return code: true    generating device token successfully
               false    generating device token failed
  Device_token: device token (string format)
</code></pre>

<h5>c) Package Generation</h5>
<p>This function is used to generate the secure upgrade package and package token.</p>
<pre><code>sec_upgrade_get_package(original_package_path,
                        secure_package_path,
                        package_token_path)
input para:
    original_package_path    original upgrade package file path
    secure_package_path    secure upgrade package file path
    package_token_path    secure package token file     
output para:
    return code:
        true    generating secure upgrade package successfully
        false    generating secure upgrade package failed
</code></pre>

<h5>d) Authorization Token Generation</h5>
<p>This function is used to generate a deviceâ€™s authorization token, based on device token and package token.</p>
<pre><code>sec_upgrade_get_authorization_token(package_token_path,
                                    device_token_path)
input para:
    package_token_path    secure package token file path
    device_token_path    device token file path
output_para:
    return code:
        true    generating authorization token successfully
        false    generating authorization token failed
        authorization_token authorization token buffer(string formate)
</code></pre>

<h5>e) Authorization Token and Package Verification</h5>
<p>This function is used to verify the downloaded secure package with the authorization token and generate the original package.</p>
<pre><code>sec_upgrade_verify_package(authorization_token_buffer,
                           secure_package_path)
input para:
    authorization_token_buffer    authorization token buffer(string format)
    secure_package_path    secure upgrade package file path
output para:
    original_package_path    original upgrade package file path
</code></pre>

<h4>3. Additional Information</h4>
<ol>
<li>SDK uses standard PEM certificates.</li>
<li>Before using SDK, users need to generate two seperate chains of certificate for server and device.</li>
<li>Certificates from the server certificate chain are deployed to server and make sure they cannot sign other certificates.</li>
<li>Certificates from the device certificate chain are deployed to device and make sure they cannot sign other certificates.</li>
<li>Root private key should not be deployed to server or devices.</li>
<li>Users need to be assigned the read and write permissions of the <code>config</code> directory and the read permission of the <code>certificate</code> directory.</li>
</ol>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ApolloAuto/apollo/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
