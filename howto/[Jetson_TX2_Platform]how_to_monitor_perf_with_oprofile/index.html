<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>[Jetson TX2 Platform]how to monitor perf with oprofile - Apollo Docs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "[Jetson TX2 Platform]how to monitor perf with oprofile";
    var mkdocs_page_input_path = "howto/[Jetson_TX2_Platform]how_to_monitor_perf_with_oprofile.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Apollo Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Get Started</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../quickstart/">Quick Start</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Cyber RT</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../cyber/">Introduction to Cyber RT</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../cyber/CyberRT_Quick_Start/">Cyber RT Quick Start</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Modules</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/perception/">Perception</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/control/">Control</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/canbus/">Canbus</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/monitor/">Monitor</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/prediction/">Prediction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/planning/">Planning</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">D-Kit</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../specs/D-kit/readme/">Introduction to D-Kit</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/">FAQs</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">CN Zone</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../how_to_solve_slow_pull_from_cn/">How to Solve GitHub Slow Pull</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Apollo Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>[Jetson TX2 Platform]how to monitor perf with oprofile</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ApolloAuto/apollo/edit/master/docs/howto/[Jetson_TX2_Platform]how_to_monitor_perf_with_oprofile.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>oprofile is a performance monitoring tool that runs on linux system. Generally, oprofile has been included in linux system modules, but oprofile module is not supported on ARM, so we have to install it manually.</p>
<p>oprofile supports multi-thread program. It records the number of function calls, and can also output the source code to show results user-friendly. So it fits well to performance monitoring on TX2.</p>
<p>Notes: oprofile has been installed in image <code>dev_aarch64_20190102_1200</code> and late, so it doesn’t need to install oprofile in Docker environment anymore.</p>
<h5 id="download">Download</h5>
<p>Download the newest version of oprofile</p>
<pre><code class="bash">$ wget http://prdownloads.sourceforge.net/oprofile/oprofile-1.3.0.tar.gz
$ tar zxvf oprofile-1.3.0.tar.gz
$ cd oprofile-1.3.0
</code></pre>

<h5 id="installation">Installation</h5>
<pre><code class="bash">$ sudo apt-get install libpopt-dev libiberty-dev binutils-dev
$ ./configure
$ make -j4
$ sudo make install
</code></pre>

<h5 id="test">Test</h5>
<p>After installation，perform command <code>operf</code> to see if it could get CPU information normally. If it fails and the output is like this:</p>
<p><code>unable to open /sys/devices/system/cpu/cpu0/online</code></p>
<p>This is because TX2 only launches 4 CPU cores by default. The other two CPU cores are closed.
Use below command to open the other two CPU cores:</p>
<pre><code class="bash">$ sudo nvpmodel -m 0
</code></pre>

<h5 id="how-to-use">How to use</h5>
<p>oprofile provides variety of commands, the commands <code>operf</code>, <code>opreport</code> and <code>opannotate</code> are used more often.
Take testing perception as an example.</p>
<ul>
<li>1.modify <code>script/apollo_bash.sh</code>, add command <code>operf</code> behind keyword <code>nuhup</code> in line 239. As shown below：</li>
</ul>
<p><img alt="operf_command" src="../images/TX2/operf_command.png" /></p>
<ul>
<li>2.use script like <code>./script/perception.sh</code> to launch perception program</li>
</ul>
<p>And now, operf is collecting data of perception program. Stopping perception program in any approach can stop the collecting process.</p>
<h5 id="output">Output</h5>
<p>After stopping perception program, a directory named oprofile_data is generated in current directory.
Use command <code>opreport</code> to show the total statistics:</p>
<pre><code class="bash">$ opreport
</code></pre>

<p>As shown below:</p>
<p><img alt="opreport_" src="../images/TX2/opreport_.png" /></p>
<p>Use command <code>opreport</code> to show the statistics of each function:</p>
<pre><code class="bash">$ opreport -l bazel-bin/modules/perception/perception 
</code></pre>

<p>Because there is too much information to show, so it’s better to save the output into a file.</p>
<pre><code class="bash">$ opreport -l bazel-bin/modules/perception/perception &gt; perception_op_funcs.md
</code></pre>

<p>As shown below:</p>
<p><img alt="opreport_file" src="../images/TX2/opreport_file.png" /></p>
<p>Use command <code>opannotate</code> to show the statistics with source code:</p>
<pre><code class="bash">$ opannotate -s bazel-bin/modules/perception/perception &gt; perception_op_details.md
</code></pre>

<p>Notice:
It only supports one operf program to be running at any time, so when operf program is running, we could launch another program with <code>operf</code>.</p>
<p>oprofile official website:
<a href="http://oprofile.sourceforge.net/news/">http://oprofile.sourceforge.net/news/</a></p>
<p>oprofile user manual:
<a href="http://oprofile.sourceforge.net/doc/index.html">http://oprofile.sourceforge.net/doc/index.html</a></p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ApolloAuto/apollo/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
