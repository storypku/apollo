<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>How to Build and Debug using VSCode - Apollo Docs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "How to Build and Debug using VSCode";
    var mkdocs_page_input_path = "howto/how_to_build_and_debug_using_vscode.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Apollo Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Get Started</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../quickstart/">Quick Start</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Cyber RT</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../cyber/">Introduction to Cyber RT</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../cyber/CyberRT_Quick_Start/">Cyber RT Quick Start</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Modules</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="../../modules/perception/README.md">Perception</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../modules/control/README.md">Control</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../modules/canbus/README.md">Canbus</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../modules/monitor/README.md">Monitor</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../modules/prediction/README.md">Prediction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/planning/">Planning</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">How-Tos</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../how_to_solve_slow_pull_from_cn/">[CN] How to Solve GitHub Slow Pull</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../how_to_document_code/">How to document code</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../how_to_install_apollo_kernel/">How to install Apollo kernel</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../how_to_install_apollo_kernel_cn/">[CN] How to install Apollo kernel</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../how_to_launch_Apollo/">How to launch and run Apollo</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">FAQs</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/">Index</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/General_FAQs/">General</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/General_FAQs_cn/">[CN] General</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Calibration_FAQs/">Calibration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Calibration_FAQs_cn/">[CN] Calibration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Perception_FAQs/">Perception</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Dreamview_FAQs/">Dreamview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Hardware_FAQs/">Hardware</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Hardware_FAQs_cn/">[CN] Hardware</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Software_FAQs/">Software</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../FAQs/Software_FAQs_cn/">[CN] Software</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">D-Kit</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../specs/D-kit/readme/">[CN] Introduction</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Apollo Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>How to Build and Debug using VSCode</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ApolloAuto/apollo/edit/master/docs/howto/how_to_build_and_debug_using_vscode.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="how-to-build-and-debug-using-vscode">How to Build and Debug using VSCode<a class="headerlink" href="#how-to-build-and-debug-using-vscode" title="Permanent link">#</a></h2>
<p>Visual Studio Code (hereafter referred to as VSCode) is Microsoft's first lightweight code editor for Linux. Find below a few configuration files that allow the use of VSCode to compile and debug the Apollo project. I will elaborate on it below, hoping to bring some help to the developers.</p>
<h3 id="compile-the-apollo-project-using-vscode">Compile the Apollo project using VSCode<a class="headerlink" href="#compile-the-apollo-project-using-vscode" title="Permanent link">#</a></h3>
<p>You could first set up the Apollo project using the <a href="https://github.com/ApolloAuto/apollo/blob/master/docs/howto/how_to_build_and_release.md">build and release</a> document under <strong>Build in Visual Studio Code</strong>. Only follow the steps until the <code>Build the Apollo Project in VSCode title</code></p>
<h4 id="configuration-file-parsing">Configuration file parsing<a class="headerlink" href="#configuration-file-parsing" title="Permanent link">#</a></h4>
<p>There are a total of four common tasks in the <code>.vscode/tasks.json</code> file: Build the apollo project, Run all unit tests for the apollo project, Code style check for the apollo project, Clean the apollo project. The first task is the default generation task, you can directly press the shortcut key <code>Ctr+Shift+B</code> to call, other tasks can be executed by executing the menu command: <code>Task-&gt;Run Task (R)...</code>.</p>
<p><img alt="1" src="../images/vscode/run_tasks.png" /></p>
<p>In the pop-up window, select the corresponding The options are as shown below:</p>
<p><img alt="2" src="../images/vscode/tasks.png" /></p>
<p>The following is the specific configuration code, please refer to the comments inside to adjust the compilation task to meet your build needs:</p>
<pre><code>{
    &quot;version&quot;: &quot;2.0.0&quot;,
    &quot;tasks&quot;: [
        {
            &quot;label&quot;: &quot;build the apollo project&quot;,
            &quot;type&quot;: &quot;shell&quot;,
            // The compilation task can be adjusted according to the options provided by &quot;apollo.sh&quot;, for example: build_gpu
            &quot;command&quot;: &quot;bash apollo_docker.sh build&quot;,
            &quot;group&quot;: {
                &quot;kind&quot;: &quot;build&quot;,
                &quot;isDefault&quot;: true // default building task invoked by &quot;Ctrl+Shift+B&quot;
            },
            // format the error message
            &quot;problemMatcher&quot;: {
                &quot;owner&quot;: &quot;cc&quot;,
                &quot;fileLocation&quot;: [
                    &quot;relative&quot;,
                    &quot;${workspaceFolder}&quot;
                ],
                &quot;pattern&quot;: {
                    &quot;regexp&quot;: &quot;^(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$&quot;,
                    &quot;file&quot;: 1,
                    &quot;line&quot;: 2,
                    &quot;column&quot;: 3,
                    &quot;severity&quot;: 4,
                    &quot;message&quot;: 5
                }
            }
        }, 
        {
            &quot;label&quot;: &quot;run all unit tests for the apollo project&quot;,
            &quot;type&quot;: &quot;shell&quot;,           
            &quot;command&quot;: &quot;bash apollo_docker.sh test&quot;,
            &quot;problemMatcher&quot;: {
                &quot;owner&quot;: &quot;cc&quot;,
                &quot;fileLocation&quot;: [
                    &quot;relative&quot;,
                    &quot;${workspaceFolder}&quot;
                ],
                &quot;pattern&quot;: {
                    &quot;regexp&quot;: &quot;^(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$&quot;,
                    &quot;file&quot;: 1,
                    &quot;line&quot;: 2,
                    &quot;column&quot;: 3,
                    &quot;severity&quot;: 4,
                    &quot;message&quot;: 5
                }
            }
        },
        {
            &quot;label&quot;: &quot;code style check for the apollo project&quot;,
            &quot;type&quot;: &quot;shell&quot;,            
            &quot;command&quot;: &quot;bash apollo_docker.sh lint&quot;,          
            &quot;problemMatcher&quot;: {
                &quot;owner&quot;: &quot;cc&quot;,
                &quot;fileLocation&quot;: [
                    &quot;relative&quot;,
                    &quot;${workspaceFolder}&quot;
                ],
                &quot;pattern&quot;: {
                    &quot;regexp&quot;: &quot;^(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$&quot;,
                    &quot;file&quot;: 1,
                    &quot;line&quot;: 2,
                    &quot;column&quot;: 3,
                    &quot;severity&quot;: 4,
                    &quot;message&quot;: 5
                }
            }
        },
        {
            &quot;label&quot;: &quot;clean the apollo project&quot;,
            &quot;type&quot;: &quot;shell&quot;,            
            &quot;command&quot;: &quot;bash apollo_docker.sh clean&quot;,           
            &quot;problemMatcher&quot;: {
                &quot;owner&quot;: &quot;cc&quot;,
                &quot;fileLocation&quot;: [
                    &quot;relative&quot;,
                    &quot;${workspaceFolder}&quot;
                ],
                &quot;pattern&quot;: {
                    &quot;regexp&quot;: &quot;^(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$&quot;,
                    &quot;file&quot;: 1,
                    &quot;line&quot;: 2,
                    &quot;column&quot;: 3,
                    &quot;severity&quot;: 4,
                    &quot;message&quot;: 5
                }
            }
        }
    ]
}
</code></pre>

<h3 id="possible-errors-and-how-to-resolve-them">Possible errors and how to resolve them<a class="headerlink" href="#possible-errors-and-how-to-resolve-them" title="Permanent link">#</a></h3>
<h4 id="error-error-query-interrupted-encountered-during-compilation">Error: "ERROR: query interrupted" encountered during compilation<a class="headerlink" href="#error-error-query-interrupted-encountered-during-compilation" title="Permanent link">#</a></h4>
<p>This is due to inconsistencies in the bazel internal cache. </p>
<h5>Solution:</h5>
<p>Press any key to exit the compilation process. In the command terminal window of VSCode (if it is not open, press the shortcut key <strong>Ctrl + `</strong> to open) execute the following command to enter the Docker environment:</p>
<pre><code class="bash">bash docker/scripts/dev_into.sh
</code></pre>

<p>Enter the following command in the Docker environment to perform the bazel cleanup cache task (must keep the network unblocked in order to successfully download the dependencies, otherwise the command will not work even if it is executed multiple times):</p>
<pre><code class="bash">bazel query //...
</code></pre>

<p>Finally, enter the <code>exit</code> command to exit the Docker environment and press the shortcut key <code>Ctrl+Shift+B</code> to re-execute the build task.</p>
<h4 id="staying-in-the-building-no-action-running-interface-for-a-long-time-during-compile-time">Staying in the "Building: no action running" interface for a long time during compile time<a class="headerlink" href="#staying-in-the-building-no-action-running-interface-for-a-long-time-during-compile-time" title="Permanent link">#</a></h4>
<p>This is due to the existence of multiple different versions of Docker or bazel internal cache inconsistency in the current system. </p>
<h5>Solution:</h5>
<p>Press the shortcut key <strong>Ctrl+C</strong> to terminate the current build process. In the command terminal window of VSCode (if it is not open, press the shortcut key <strong>Ctrl + `</strong> to open), use any of the following methods to stop:</p>
<ol>
<li>Stop all current running processes in Docker
    <code>bash
    docker stop $(docker ps -a | grep apollo | awk '{print $1}')</code></li>
<li>Stop all instances of Docker
    <code>bash
    docker stop $(docker ps -aq)</code></li>
<li>Execute the VSCode menu command: <code>Tasks -&gt; Run Tasks (R)...</code></li>
<li>In the pop-up window, select "clean the apollo project". </li>
<li>Once complete, press the shortcut key <code>Ctrl+Shift+B</code> to rebuild the Apollo project.</li>
</ol>
<h4 id="error-another-command-pid2466-is-running-waiting-for-it-to-complete-appears-at-compile-time">Error: "Another command (pid=2466) is running. Waiting for it to complete..." appears at compile time<a class="headerlink" href="#error-another-command-pid2466-is-running-waiting-for-it-to-complete-appears-at-compile-time" title="Permanent link">#</a></h4>
<p>This is caused by compiling in other command line terminals or by pressing the <code>Ctrl+C</code> key during the previous compilation, causing the compiling process' execution to only partially complete.</p>
<h5>Solution:</h5>
<p>Press the shortcut key <code>Ctrl+C</code> to terminate the current build process. In the command terminal window of VSCode (if it is not open, press the shortcut key <strong>Ctrl + `</strong> to open it), use the following command to terminate the residual build process:</p>
<ol>
<li>
<p>Enter Docker</p>
<p><code>bash
bash docker/scripts/dev_into.sh</code></p>
</li>
<li>
<p>Kill the remaining compilation process in Docker</p>
<p><code>bash
pkill bazel-real</code></p>
</li>
<li>
<p>Check if the bazel-real process remains in the Docker. If yes, press <code>q</code> to exit and perform step 2 again. Also use <code>ps aux | grep bazel-real</code> to view</p>
</li>
<li>
<p>Exit Docker using </p>
<p><code>bash
exit</code></p>
</li>
<li>
<p>Press the shortcut key <code>Ctrl+Shift+B</code> to re-execute the build task.</p>
</li>
</ol>
<h3 id="debugging-apollo-locally-using-vscode">Debugging Apollo locally using VSCode<a class="headerlink" href="#debugging-apollo-locally-using-vscode" title="Permanent link">#</a></h3>
<p>The Apollo project runs in Docker and cannot be used directly on the host machine. It must be created in Docker with GDBServer. Debug the service process, and then use GDB to connect to the debug service process in Docker on the host machine. The specific operation methods are as follows:</p>
<h4 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">#</a></h4>
<p>The main prerequisites include collecting debugging information and installing the GDBServer if it is not already present in Docker</p>
<h5>Collecting debugging information</h5>
<p>When compiling Apollo projects, you will need to use debugging information options such as <strong>build</strong> or <strong>build_gpu</strong>. Optimization options such as <strong>build_opt</strong> or <strong>build_opt_gpu</strong> cannot be used.</p>
<h5>Install GDBServer inside Docker</h5>
<p>After entering Docker, you can use the following command to view if the GDBServer is present:</p>
<pre><code class="bash">gdbserver --version
</code></pre>

<p>If the prompt is similar to the following information:</p>
<pre><code>GNU gdbserver (Ubuntu 7.7.1-0ubuntu5~14.04.3) 7.7.1
Copyright (C) 2014 Free Software Foundation, Inc.
gdbserver is free software, covered by the GNU General Public License.
This gdbserver was configured as &quot;x86_64-linux-gnu&quot;
</code></pre>

<p>It means that GDBServer has been installed inside Docker. You should be able to view the prompt below. But if the GDBServer is not present and  if you are prompted with the following information:</p>
<pre><code>bash: gdbserver: command not found
</code></pre>

<p>Then you would need to install the GDBServer using </p>
<pre><code class="bash">sudo apt-get install gdbserver
</code></pre>

<h4 id="docker-internal-operations">Docker Internal Operations<a class="headerlink" href="#docker-internal-operations" title="Permanent link">#</a></h4>
<h5>Start the Dreamview daemon</h5>
<p>Go to Docker and start Dreamview. The command is as follows:</p>
<pre><code>cd into your_apollo_project_root_dir
# If Docker is not started, start it first, otherwise ignore this step
Bash docker/scripts/dev_start.sh -C
# Enter Docker
Bash docker/scripts/dev_into.sh
# Start Dreamview background service
Bash scripts/bootstrap.sh
</code></pre>

<h5>Start the module that needs debugging</h5>
<p>Start the module to be debugged, either by using the command line or by using the Dreamview interface. The following is an example of debugging the <strong>Planning</strong> module from the Dreamview interface. Open Chrome browser, enter the URL: http://localhost:8888/, open the Dreamview interface, open the <strong>SimControl</strong> option, as shown below:</p>
<p><img alt="7" src="../images/vscode/enable_simcontrol.png" /></p>
<p>Click on the <code>Module Controler</code> tab on the left toolbar and select the "Routing" and <code>Planning</code> options as shown below:</p>
<p><img alt="8" src="../images/vscode/start_routing_and_planning.png" /></p>
<p>Click the <code>Default Routing</code> tab on the left toolbar, select <code>Route: Reverse Early Change Lane</code> or any of these options, send a <code>Routing Request</code> request, and generate a global navigation path, as shown below:</p>
<p><img alt="9" src="../images/vscode/check_route_reverse_early_change_lane.png" /></p>
<h5>Viewing the "Planning" Process ID</h5>
<p>Use the following command to view the "Planning" process ID:</p>
<pre><code class="bash">ps aux | grep mainboard | grep planning
</code></pre>

<p>The result in the following figure is similar to the previous figure, you can see that the <code>Planning</code> process ID is 4147.</p>
<p><img alt="11" src="../images/vscode/planning_id_ps.png" /></p>
<h5>Debugging Planning module using GDBServer</h5>
<p>Next we need to carry out our key operations, using GDBServer to additionally debug the <code>Planning</code> process, the command is as follows:</p>
<pre><code class="bash">sudo gdbserver :1111 --attach 4147
</code></pre>

<p>In the above command, ":1111" indicates that the debugging service process with the port "1111" is enabled, and "4147" indicates the "Planning" process ID. If the result is as shown below, the operation is successful.</p>
<p><img alt="12" src="../images/vscode/gdbserver_attach_debug.png" /></p>
<p>After restarting a command terminal and entering Docker, use the following command to see that the "gdbserver" process is running normally:</p>
<pre><code class="bash">ps aux | grep gdbserver
</code></pre>

<p><img alt="13" src="../images/vscode/view_gdbserver_process.png" /></p>
<h5>Starting GDBServer with a Script File</h5>
<p>There are two script files: <code>scripts/start_gdb_server.sh</code> which is used to start GDBServer inside Docker and <code>docker/scripts/dev_start_gdb_server.sh</code> which starts GDBServer directly on the host (outside Docker). Suppose the debugging planning module, the port number is 1111, and the usage of scripts/start_gdb_server.sh is:</p>
<pre><code class="bash"># Enter Docker
Bash docker/scripts/dev_into.sh
# Start the gdbserver
Bash scripts/start_gdb_server.sh planning 1111
</code></pre>

<p>Assuming that while debugging the planning module, the port number is 1111, the usage of <code>docker/scripts/dev_start_gdb_server.sh</code> is:</p>
<pre><code class="bash"># Start gdbserver directly on the host machine (outside Docker)
bash docker/scripts/dev_start_gdb_server.sh planning 1111
</code></pre>

<h4 id="configure-the-vscode-file">Configure the VSCode file<a class="headerlink" href="#configure-the-vscode-file" title="Permanent link">#</a></h4>
<p>Configuration is necessary so that the shortcut can be activated by pressing the shortcut key "F5" in VSCode. The contents of <strong>start_gdb_server.sh</strong> are as follows:</p>
<pre><code class="bash">#!/usr/bin/env bash

function print_usage() {
  RED='\033[0;31m'
  BLUE='\033[0;34m'
  BOLD='\033[1m'
  NONE='\033[0m'

  echo -e &quot;\n${RED}Usage${NONE}:
  .${BOLD}/start_gdb_server.sh${NONE} MODULE_NAME PORT_NUMBER&quot;

  echo -e &quot;${RED}MODULE_NAME${NONE}:
  ${BLUE}planning${NONE}: debug the planning module. 
  ${BLUE}control${NONE}: debug the control module.
  ${BLUE}routing${NONE}: debug the routing module.
  ..., and so on.&quot;

  echo -e &quot;${RED}PORT_NUMBER${NONE}: 
  ${NONE}a port number, such as '1111'.&quot;
}

if [ $# -lt 2 ];then
    print_usage
    exit 1
fi

DIR=&quot;$( cd &quot;$( dirname &quot;${BASH_SOURCE[0]}&quot; )&quot; &amp;&amp; pwd )&quot;
source &quot;${DIR}/apollo_base.sh&quot;

MODULE_NAME=$1
PORT_NUM=$2
shift 2

# If there is a gdbserver process running, stop it first. 
GDBSERVER_NUMS=$(pgrep -c -x &quot;gdbserver&quot;)
if [ ${GDBSERVER_NUMS} -ne 0 ]; then
  sudo pkill -SIGKILL -f &quot;gdbserver&quot;
fi

echo ${MODULE_NAME}
# Because the &quot;grep ${MODULE_NAME}&quot; always generates a process with the name of 
# &quot;${MODULE_NAME}&quot;, I added another grep to remove grep itself from the output.
PROCESS_ID=$(ps -ef | grep &quot;mainboard&quot; | grep &quot;${MODULE_NAME}&quot; | grep -v &quot;grep&quot; | awk '{print $2}')
echo ${PROCESS_ID}

# If the moudle is not started, start it first. 
if [ -z ${PROCESS_ID} ]; then       
  #echo &quot;The '${MODULE_NAME}' module is not started, please start it in the dreamview first. &quot;  
  #exit 1 

  # run function from apollo_base.sh
  # run command_name module_name
  run ${MODULE_NAME} &quot;$@&quot;

  PROCESS_ID=$(ps -ef | grep &quot;mainboard&quot; | grep &quot;${MODULE_NAME}&quot; | grep -v &quot;grep&quot; | awk '{print $2}')
  echo ${PROCESS_ID}
fi 

sudo gdbserver :${PORT_NUM} --attach ${PROCESS_ID}
</code></pre>

<p>The contents of <strong>dev_start_gdb_server.sh</strong> are as follows:</p>
<pre><code class="bash">#!/usr/bin/env bash

function check_docker_open() {
  docker ps --format &quot;{{.Names}}&quot; | grep apollo_dev 1&gt;/dev/null 2&gt;&amp;1
  if [ $? != 0 ]; then       
    echo &quot;The docker is not started, please start it first. &quot;  
    exit 1  
  fi
}

function print_usage() {
  RED='\033[0;31m'
  BLUE='\033[0;34m'
  BOLD='\033[1m'
  NONE='\033[0m'

  echo -e &quot;\n${RED}Usage${NONE}:
  .${BOLD}/dev_debug_server.sh${NONE} MODULE_NAME PORT_NUMBER&quot;

  echo -e &quot;${RED}MODULE_NAME${NONE}:
  ${BLUE}planning${NONE}: debug the planning module. 
  ${BLUE}control${NONE}: debug the control module.
  ${BLUE}routing${NONE}: debug the routing module.
  ..., and so on.&quot;

  echo -e &quot;${RED}PORT_NUMBER${NONE}: 
  ${NONE}a port number, such as '1111'.&quot;
}

if [ $# -lt 2 ];then
    print_usage
    exit 1
fi

check_docker_open

DIR=&quot;$( cd &quot;$( dirname &quot;${BASH_SOURCE[0]}&quot; )&quot; &amp;&amp; pwd )&quot;
cd &quot;${DIR}/../..&quot;
# pwd

xhost +local:root 1&gt;/dev/null 2&gt;&amp;1
#echo $@
docker exec \
    -u $USER \
    -it apollo_dev \
    /bin/bash scripts/start_gdb_server.sh $@
xhost -local:root 1&gt;/dev/null 2&gt;&amp;1
</code></pre>

<h4 id="internal-operations-of-vscode-on-the-host">Internal operations of VSCode on the host<a class="headerlink" href="#internal-operations-of-vscode-on-the-host" title="Permanent link">#</a></h4>
<p>Use VSCode on the host to open the Apollo project (must be the version you just built), open the file you need to debug, set a breakpoint at the specified location, and press <code>F5</code> to start debugging. </p>
<pre><code>Note: Since VSCode is written in a scripting language, the boot process will be slower. If the Internet speed is not fast enough, even a one-minute wait may be possible. The debugging method is similar to Visual Studio and will not be described here. As shown below:
</code></pre>

<p><img alt="14" src="../images/vscode/vscode_debug_interface.png" /></p>
<h4 id="configuration-file-resolution">Configuration File Resolution<a class="headerlink" href="#configuration-file-resolution" title="Permanent link">#</a></h4>
<p>The <code>.vscode/launch.json</code> file is configured to connect to the debug service process in Docker in VSCode. In addition, in order to start GDBServer directly in VSCode, a pre-debug startup task was added to the <code>.vscode/launch.json</code> file: <code>"preLaunchTask": "start gdbserver"</code>, which corresponds to the .vscode/tasks.json file. One of the tasks, is used to start the GDBServer. The configuration of the .vscode/launch.json file is as follows</p>
<pre><code>{
    &quot;version&quot;: &quot;0.2.0&quot;,
    &quot;configurations&quot;: [
    {
        &quot;name&quot;: &quot;C++ Launch&quot;,
        &quot;type&quot;: &quot;cppdbg&quot;,
        &quot;request&quot;: &quot;launch&quot;,
        &quot;program&quot;: &quot;${workspaceRoot}/bazel-bin/cyber/mainboard&quot;,
        // You can change &quot;localhost:1111&quot; to another &quot;IP:port&quot; name, but it 
        // should be same as those in gdbserver of the docker container.  
        &quot;miDebuggerServerAddress&quot;: &quot;localhost:1111&quot;,
        // You can set the name of the module to be debugged in the 
        // &quot;.vscode/tasks.json&quot; file, for example &quot;planning&quot;.
        // Tips: search the label &quot;start gdbserver&quot; in &quot;.vscode/tasks.json&quot;.
        // The port number should be consistent with this file.        
        &quot;preLaunchTask&quot;: &quot;start gdbserver&quot;,
        &quot;args&quot;: [],
        &quot;stopAtEntry&quot;: false,
        &quot;cwd&quot;: &quot;${workspaceRoot}&quot;,
        &quot;environment&quot;: [],
        &quot;externalConsole&quot;: true,
        &quot;linux&quot;: {
            &quot;MIMode&quot;: &quot;gdb&quot;
        },
        &quot;osx&quot;: {
            &quot;MIMode&quot;: &quot;gdb&quot;
        },
        &quot;windows&quot;: {
            &quot;MIMode&quot;: &quot;gdb&quot;
        }
    }
    ]
}
</code></pre>

<p>The task for starting GDBServer in the <code>.vscode/tasks.json</code> file is configured as follows:</p>
<pre><code>        {
            &quot;label&quot;: &quot;start gdbserver&quot;,
            &quot;type&quot;: &quot;shell&quot;,
            // you can change the &quot;planning&quot; module name to another one and 
            // change the &quot;1111&quot; to another port number. The port number should 
            // be same as that in the &quot;launch.json&quot; file. 
            &quot;command&quot;: &quot;bash docker/scripts/dev_start_gdb_server.sh planning 1111&quot;,            
            &quot;isBackground&quot;: true,
            &quot;problemMatcher&quot;: {
                &quot;owner&quot;: &quot;custom&quot;,
                &quot;pattern&quot;: {
                    &quot;regexp&quot;: &quot;__________&quot;
                },
                &quot;background&quot;: { 
                    &quot;activeOnStart&quot;: true,
                    // Don't change the following two lines, otherwise the 
                    // gdbserver can't run in the background.
                    &quot;beginsPattern&quot;: &quot;^Listening on port$&quot;,
                    &quot;endsPattern&quot;: &quot;^$&quot;
                }
            }                           
        }
</code></pre>

<h4 id="possible-errors-and-their-solutions">Possible Errors and their Solutions<a class="headerlink" href="#possible-errors-and-their-solutions" title="Permanent link">#</a></h4>
<p>During the debugging process, you may encounter the following problems: </p>
<h5>The Docker internal debugging process crashes and cannot be debugged in VSCode</h5>
<p><img alt="15" src="../images/vscode/failed_to_connect_gdbserver.png" />    </p>
<h5>Solution</h5>
<p>The solution is to restart the debugging process inside Docker.</p>
<h5>the network connection is not smooth, can not be debugged in VSCode</h5>
<h5>Solution</h5>
<p>The solution is to ensure the network is smooth, and disable the agent tool</p>
<h5>Once debugging is complete, the debugging service process inside Docker shuts down</h5>
<p>It may happen that the debugging service mileage cannot be started again in VSCode. </p>
<h5>Solution</h5>
<p>The solution is to restart the debugging service process inside Docker, and then in VSCode. Press “F5” to start debugging.</p>
<h3 id="remote-debugging-using-vscode">Remote debugging using VSCode<a class="headerlink" href="#remote-debugging-using-vscode" title="Permanent link">#</a></h3>
<p>During the R&amp;D process, we also need to remotely debug the Apollo project on the industrial computer inside the vehicle, that is, connect the in-vehicle industrial computer with the SSH service on the debugging computer, start the relevant process in the industrial computer, and then perform remote debugging on the debugging computer. The following is an example of debugging the planning module:</p>
<h4 id="view-the-ip-address-of-the-industrial-computer-in-the-car">View the IP address of the industrial computer in the car<a class="headerlink" href="#view-the-ip-address-of-the-industrial-computer-in-the-car" title="Permanent link">#</a></h4>
<p>On the industrial computer in the car, check the IP of the machine by the following command:</p>
<pre><code class="bash">ifconfig
</code></pre>

<h4 id="open-dreamview-in-the-browser-of-the-debugging-computer-and-start-the-module-to-be-debugged">Open Dreamview in the browser of the debugging computer and start the module to be debugged<a class="headerlink" href="#open-dreamview-in-the-browser-of-the-debugging-computer-and-start-the-module-to-be-debugged" title="Permanent link">#</a></h4>
<p>Assuming that the IP address of the industrial computer LAN is: 192.168.3.137, open your Chrome or Firefox browser, enter the following URL: http://192.168.3.137:8888/, start the module (<code>Planning</code>) to be debugged as shown in <a href="#Start-the-module-that-needs-debugging">Start the module that needs debugging</a> section</p>
<p><img alt="17" src="../images/vscode/remote_show_dreamview.png" /></p>
<h4 id="use-the-ssh-command-to-remotely-log-in-to-the-industrial-pc-and-start-the-gdbserver-service-of-the-industrial-pc">Use the SSH Command to Remotely Log In to the Industrial PC and Start the Gdbserver Service of the Industrial PC<a class="headerlink" href="#use-the-ssh-command-to-remotely-log-in-to-the-industrial-pc-and-start-the-gdbserver-service-of-the-industrial-pc" title="Permanent link">#</a></h4>
<p>Assume that the user name of the industrial computer in the car is <code>xxxxx</code>, and the IP address of the LAN is <code>192.168.3.137</code>. Use the following command to remotely log in to the industrial computer:</p>
<pre><code class="bash">ssh xxxxx@192.168.3.137
</code></pre>

<p>After successfully entering the IPC, assume that the Planning module needs to be debugged, and the port number is 1111, use the following command to start the gdbserver service of the in-vehicle IPC:</p>
<pre><code class="bash"># Switch to the Apollo project root directory on the industrial computer
cd ~/code/apollo
# Start the gdbserver service outside of Docker
bash docker/scripts/dev_start_gdb_server.sh planning 1111
</code></pre>

<p>As shown in the figure below, if you see a prompt similar to Listening on port 1111, the gdbserver service starts successfully.</p>
<p><img alt="19" src="../images/vscode/remote_start_gdbserver.png" /></p>
<h4 id="using-the-vscode-remote-debugging-on-the-debugging-computer-the-planning-module-on-the-industrial-computer">Using the VSCode remote debugging on the debugging computer, the planning module on the industrial computer<a class="headerlink" href="#using-the-vscode-remote-debugging-on-the-debugging-computer-the-planning-module-on-the-industrial-computer" title="Permanent link">#</a></h4>
<p>Open the Apollo project using VSCode on the debug computer. Note that the project version should be the same as the version on the industrial computer, otherwise many inconsistencies will be output when debugging. First, the pre-debug load task in the configuration file .vscode/launch.json: "preLaunchTask": "start gdbserver", comment out, and then modify the remote debug service address to: "miDebuggerServerAddress": "192.168.3.137:1111" ,,As shown below:</p>
<p><img alt="20" src="../images/vscode/config_launch_json_for_remote_debug.png" /></p>
<p>Set the breakpoint at the desired location, press <code>F5</code> to start debugging, because it is a remote connection, the startup wait time will be longer, even more than 1 minute. The figure below is the remote debugging interface. </p>
<pre><code>Note: Every time you start debugging in VSCode, you need to start the debugging operation again in the command line terminal, and restart the gdbserver service process in the industrial computer.
You can omit this step if you have configured a preLaunchTask task.
</code></pre>

<p><img alt="21" src="../images/vscode/remote_debug_planning_module.png" /></p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ApolloAuto/apollo/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
